<html lang="pt-BR" class="scroll-smooth">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Galeria de Mídias</title>
<script src="https://cdn.tailwindcss.com"></script>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
/>
<style>
  /* Custom fade-in animation */
  @keyframes fadeInUp {
    0% {
      opacity: 0;
      transform: translateY(10px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .fade-in-up {
    animation: fadeInUp 0.6s ease forwards;
  }
</style>
</head>
<body class="bg-[#0a0a0a] text-white min-h-screen flex flex-col">
<header class="py-8 px-4 sm:px-6 lg:px-8 flex justify-center border-b border-gray-800">
  <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight select-none">
    Galeria de Mídias
  </h1>
</header>

<main class="flex-grow px-4 sm:px-6 lg:px-8 py-8 max-w-7xl mx-auto">
  <section id="gallery" class="grid gap-6
    grid-cols-1
    sm:grid-cols-2
    md:grid-cols-3
    lg:grid-cols-4
    xl:grid-cols-5
  ">
    <!-- Mídias serão inseridas aqui via JS -->
  </section>
</main>

<script>
  // Extensões aceitas
  const imageExtensions = ['jpg', 'jpeg', 'png', 'gif'];
  const videoExtensions = ['mp4', 'webm'];

  // Função para criar o card da mídia
  function createMediaCard(src, type, index) {
    const card = document.createElement('article');
    card.className =
      'flex flex-col bg-[#121212] rounded-lg shadow-md overflow-hidden transform transition-transform duration-300 ease-in-out hover:scale-[1.03] hover:shadow-lg fade-in-up';
    card.style.animationDelay = `${index * 100}ms`;

    // Container da mídia para efeito hover brilho/zoom
    const mediaContainer = document.createElement('div');
    mediaContainer.className =
      'relative overflow-hidden flex justify-center items-center bg-black';

    if (type === 'image') {
      const img = document.createElement('img');
      img.src = src;
      img.alt = `Imagem da galeria mostrando conteúdo visual detalhado para a mídia localizada em ${src}`;
      img.loading = 'lazy';
      img.className =
        'w-full h-auto object-cover transition-transform duration-300 ease-in-out brightness-90 hover:brightness-110 hover:scale-105';
      mediaContainer.appendChild(img);
    } else if (type === 'video') {
      const video = document.createElement('video');
      video.src = src;
      video.setAttribute('playsinline', '');
      video.setAttribute('webkit-playsinline', '');
      video.controls = false;
      video.preload = 'metadata';
      video.className =
        'w-full h-auto object-cover transition-transform duration-300 ease-in-out brightness-90 hover:brightness-110 hover:scale-105 cursor-pointer rounded-t-lg bg-black';

      // Custom play/pause overlay icon
      const playPauseOverlay = document.createElement('div');
      playPauseOverlay.className =
        'absolute inset-0 flex justify-center items-center text-white text-5xl opacity-70 pointer-events-none select-none';
      playPauseOverlay.innerHTML = '<i class="fas fa-play"></i>';
      mediaContainer.appendChild(playPauseOverlay);

      // Toggle play/pause on click
      mediaContainer.addEventListener('click', () => {
        if (video.paused) {
          video.play();
          playPauseOverlay.innerHTML = '<i class="fas fa-pause"></i>';
          playPauseOverlay.style.opacity = '0.7';
        } else {
          video.pause();
          playPauseOverlay.innerHTML = '<i class="fas fa-play"></i>';
          playPauseOverlay.style.opacity = '0.7';
        }
      });

      // Hide overlay icon when video is playing, show when paused
      video.addEventListener('play', () => {
        playPauseOverlay.style.opacity = '0';
      });
      video.addEventListener('pause', () => {
        playPauseOverlay.style.opacity = '0.7';
      });
      video.addEventListener('ended', () => {
        playPauseOverlay.innerHTML = '<i class="fas fa-play"></i>';
        playPauseOverlay.style.opacity = '0.7';
      });

      mediaContainer.appendChild(video);
    }

    card.appendChild(mediaContainer);

    // Botão "Acessar FMS"
    const btn = document.createElement('a');
    btn.href = 'fms.html';
    btn.target = '_self';
    btn.rel = 'noopener noreferrer';
    btn.className =
      'mt-3 mb-4 mx-4 py-2 px-4 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-md text-center font-semibold text-white shadow-md transition duration-300 ease-in-out hover:brightness-125 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2';
    btn.textContent = 'Acessar FMS';

    card.appendChild(btn);

    return card;
  }

  // Função para carregar mídias da pasta "media"
  async function loadMedia() {
    const gallery = document.getElementById('gallery');

    try {
      // Faz uma requisição para listar os arquivos da pasta "media"
      // Como não é possível listar arquivos via JS puro no browser,
      // assumimos que o servidor disponibiliza um arquivo JSON com a lista
      // ou um endpoint que retorna os arquivos.
      // Como o requisito é não listar manualmente, vamos simular a listagem
      // via fetch de um arquivo "media/list.json" que deve conter a lista.
      // Caso não exista, vamos tentar buscar via fetch do diretório (não suportado em geral).
      // Para este exemplo, vamos tentar buscar "media/list.json".

      const response = await fetch('media/mcmirella.json', {cache: "no-store"});
      if (!response.ok) throw new Error('Não foi possível carregar a lista de mídias.');

      const mediaList = await response.json();

      // mediaList deve ser um array de strings com nomes dos arquivos
      // Exemplo: ["foto1.jpg", "video1.mp4", "imagem2.png", ...]

      mediaList.forEach((fileName, index) => {
        const ext = fileName.split('.').pop().toLowerCase();
        const src = `media/${fileName}`;

        if (imageExtensions.includes(ext)) {
          const card = createMediaCard(src, 'image', index);
          gallery.appendChild(card);
        } else if (videoExtensions.includes(ext)) {
          const card = createMediaCard(src, 'video', index);
          gallery.appendChild(card);
        }
      });
    } catch (error) {
      // Caso não tenha list.json, exibir mensagem
      gallery.innerHTML =
        '<p class="col-span-full text-center text-gray-400">Não foi possível carregar as mídias. Certifique-se que o arquivo <code>media/list.json</code> existe e está acessível.</p>';
      console.error(error);
    }
  }

  // Chama a função para carregar as mídias ao carregar a página
  window.addEventListener('DOMContentLoaded', loadMedia);
</script>
</body>
</html>
